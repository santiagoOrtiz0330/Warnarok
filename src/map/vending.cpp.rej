diff a/src/map/vending.cpp b/src/map/vending.cpp	(rejected hunks)
@@ -10,6 +10,9 @@
 #include "../common/showmsg.hpp" // ShowInfo
 #include "../common/strlib.hpp"
 #include "../common/timer.hpp"  // DIFF_TICK
+#ifdef BGEXTENDED
+#include "../common/utils.hpp"
+#endif
 
 #include "achievement.hpp"
 #include "atcommand.hpp"
@@ -334,14 +337,26 @@ int8 vending_openvending(struct map_session_data* sd, const char* message, const
 
 		index -= 2; // offset adjustment (client says that the first cart position is 2)
 
+#ifdef BGEXTENDED
 		if( index < 0 || index >= MAX_CART // invalid position
 		||  pc_cartitem_amount(sd, index, amount) < 0 // invalid item or insufficient quantity
 		//NOTE: official server does not do any of the following checks!
 		||  !sd->cart.u.items_cart[index].identify // unidentified item
 		||  sd->cart.u.items_cart[index].attribute == 1 // broken item
 		||  sd->cart.u.items_cart[index].expire_time // It should not be in the cart but just in case
+		||  (sd->cart.u.items_cart[index].card[0]==CARD0_CREATE && (MakeDWord(sd->cart.u.items_cart[index].card[2],sd->cart.u.items_cart[index].card[3]) == (battle_config.bg_reserved_char_id || battle_config.woe_reserved_char_id) && !battle_config.bg_can_trade))
 		||  (sd->cart.u.items_cart[index].bound && !pc_can_give_bounded_items(sd)) // can't trade account bound items and has no permission
 		||  !itemdb_cantrade(&sd->cart.u.items_cart[index], pc_get_group_level(sd), pc_get_group_level(sd)) ) // untradeable item
+#else
+		if( index < 0 || index >= MAX_CART // invalid position
+		||  pc_cartitem_amount(sd, index, amount) < 0 // invalid item or insufficient quantity
+		//NOTE: official server does not do any of the following checks!
+		||  !sd->cart.u.items_cart[index].identify // unidentified item
+		||  sd->cart.u.items_cart[index].attribute == 1 // broken item
+		||  sd->cart.u.items_cart[index].expire_time // It should not be in the cart but just in case
+		||  (sd->cart.u.items_cart[index].bound && !pc_can_give_bounded_items(sd)) // can't trade account bound items and has no permission
+		||  !itemdb_cantrade(&sd->cart.u.items_cart[index], pc_get_group_level(sd), pc_get_group_level(sd)) ) // untradeable item
+#endif
 			continue;
 
 		sd->vending[i].index = index;
